/* WorldData.js
 * Definition for WorldData object
 * 
 */
 
 
  		/* 
  			DESIGN NOTE: 
  		
  			I'm dynamically building objects from their parsed JSON objects, along 
  			with their getters and setters (see HelperFunctions.js), to keep the 
  			design flexible in anticipation of future user-made modules, but it's 
  			clear that a certain amount of standardization (see hard-coding the 
  			'.world' and '.megatile' properties below).  We should be thinking 
  			about what properties we require (id - generated by us?, x & y of 
  			tiles, width and height of world, etc, and what's dynamically gotten 
  			from the user (e.g., num_buffalo).  We need to think about how that 
  			would a actually be useable if the user doesn't write any JavaScript, though.
  		*/


function WorldData(){
	this.megaTiles = new Array();
	this.players = new Array();
	this.globalNames = new GlobalNames();
}
 
WorldData.prototype = {

  	constructor: WorldData, 
  	
  	initializeWithData : function(){
  		this.populateWorldObj();
  		this.populateMegatileObjs();
  	},
  	
  	populateWorldObj : function(){
  		var theWorldData = (JSON.parse(sampleWorldData)).world;
  		helperFunctions.addPropertiesFromObjToObj(theWorldData, this);
		helperFunctions.buildGettersAndSettersFromPropertiesForObj(this);
  	},
  	
  		// CURRENTLY WORKING FOR ONE, HARDCODED MEGATILE
  	populateMegatileObjs : function(){
  	  	this.initializeTileMap();
  		var theTileData = (JSON.parse(sampleTileData)).megatile;
  		this.updateMegaTileFromObj(theTileData);
  	},
  	
  	initializeTileMap : function(){
  		if(this.height && this.width){
  			var count = this.height * this.width;
  			for(var id = 0; id < count; id++)
  				this.megaTiles.push(new MegaTile(id));
  		}
  		else
  			console.log("WorldData.intitializeTileMap(): height, width: " + this.height + ", " + this.width);
  	},
  	
  	// we may want to change to from x,y - whatever we think 
  	// will be clear and consistent
  	megaTileFromId : function(anId){
  		var mt = this.megaTiles[anId];
  		if(mt)
  			return mt;
  		else{
  			console.log("WorldData.megatileFromId(): MegaTile id: " + anId + " value: " + mt);
  		  	return null;
  		}
  	},
  	
  	updateMegaTileFromObj : function(fromObj){
  		var toObj = this.megaTileFromId(fromObj.id);
  		helperFunctions.addPropertiesFromObjToObj(fromObj, toObj);


/****

	make count dynamic - get the megatile's height and width,
	then do more testing 

****/

  		var count = this.height * this.width;
  		for(var i = 0; i < count; i++){
  			this.megaTiles[fromObj.id].resource_tiles.push(new ResourceTile());
  			helperFunctions.addPropertiesFromObjToObj(fromObj.resource_tiles[i], this.megaTiles[fromObj.id].resource_tiles[i]);
  		}
  			
  	},	
};

/***
	SAMPLE WORLD DATA 

"id":1,
"name":"eagle",
"year_start":1800,
"year_current":1800,
"height":126,
"width":126,
"megatile_width":3,
"megatile_height":3,
"created_at":"2012-12-30T22:08:43Z",
"updated_at":"2012-12-30T22:08:43Z",
"players":[{"id":1,"name":"Ben ","user_id":1,"type":"Lumberjack","world_id":1,"world_name":"eagle"}],
"turn_started_at":"2012-12-30T22:08:43Z",
"current_turn":1,
"marten_suitable_tile_count":2889,
"human_population":0,
"livable_tiles_count":0

***/
 
var sampleWorldData = '{"world":{"id":1,"name":"eagle","year_start":1800,"year_current":1800,"height":126,"width":126,"megatile_width":3,"megatile_height":3,"created_at":"2012-12-30T22:08:43Z","updated_at":"2012-12-30T22:08:43Z","players":[{"id":1,"name":"Ben ","user_id":1,"type":"Lumberjack","world_id":1,"world_name":"eagle"}],"turn_started_at":"2012-12-30T22:08:43Z","current_turn":1,"marten_suitable_tile_count":2889,"human_population":0,"livable_tiles_count":0}}';

/***
	SAMPLE RESOURCE_TILE DATA 

"megatile":
id":1,"
x":0,
"y":0,
"updated_at":"2012-12-30T22:24:44Z",
"owner":null,	
"resource_tiles":[
	"id":1,
	"x":0,
	"y":0,
	"type":"LandTile",
	"base_cover_type":"forest",
	"permitted_actions":[],
	"zone_type":"none",
	"local_desirability_score":3.5917,
	"total_desirability_score":10.0,
	"can_be_surveyed":false,
	"is_surveyed":false,
	"bought_by_developer":false,
	"bought_by_timber_company":false,
	"outpost_requested":false,
	"survey_requested":false,
	"is_marten_suitable":true,
	"primary_use":"Forest",
	"zoning_code":12,
	"tree_density":0.9,this.megaTiles
	"land_cover_type":"deciduous",
	"tree_size":8.0,
	"development_intensity":null,
	"imperviousness":0.0,
	"num_2_inch_diameter_trees":32.0,
	"num_4_inch_diameter_trees":33.0,
	"num_6_inch_diameter_trees":19.0,
	"num_8_inch_diameter_trees":18.0,
	"num_10_inch_diameter_trees":9.0,
	"num_12_inch_diameter_trees":14.0,
	"num_14_inch_diameter_trees":14.0,
	"num_16_inch_diameter_trees":8.0,
	"num_18_inch_diameter_trees":5.0,
	"num_20_inch_diameter_trees":6.0,
	"num_22_inch_diameter_trees":2.0,
	"num_24_inch_diameter_trees":0.0,
	"housing_capacity":0,
	"housing_occupants":0,
	"housing_type":null,
	"harvest_area":false,
	"supported_saplings":0,
	"tree_type":"none",
	"outpost":false,
	"marten_population":0.0,
	"vole_population":0.0
}

***/

var sampleTileData = '{"megatile":{"id":1,"x":0,"y":0,"updated_at":"2012-12-30T22:24:44Z","owner":null,"resource_tiles":[{"id":1,"x":0,"y":0,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":3.5917,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":true,"primary_use":"Forest","zoning_code":12,"tree_density":0.9,"land_cover_type":"deciduous","tree_size":8.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":32.0,"num_4_inch_diameter_trees":33.0,"num_6_inch_diameter_trees":19.0,"num_8_inch_diameter_trees":18.0,"num_10_inch_diameter_trees":9.0,"num_12_inch_diameter_trees":14.0,"num_14_inch_diameter_trees":14.0,"num_16_inch_diameter_trees":8.0,"num_18_inch_diameter_trees":5.0,"num_20_inch_diameter_trees":6.0,"num_22_inch_diameter_trees":2.0,"num_24_inch_diameter_trees":0.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":2,"x":1,"y":0,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":3.66525,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":true,"primary_use":"Forest","zoning_code":12,"tree_density":0.94,"land_cover_type":"deciduous","tree_size":10.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":43.0,"num_4_inch_diameter_trees":39.0,"num_6_inch_diameter_trees":27.0,"num_8_inch_diameter_trees":10.0,"num_10_inch_diameter_trees":19.0,"num_12_inch_diameter_trees":9.0,"num_14_inch_diameter_trees":9.0,"num_16_inch_diameter_trees":7.0,"num_18_inch_diameter_trees":7.0,"num_20_inch_diameter_trees":3.0,"num_22_inch_diameter_trees":8.0,"num_24_inch_diameter_trees":1.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":3,"x":2,"y":0,"type":"LandTile","base_cover_type":"cultivated_crops","permitted_actions":[],"zone_type":"none","local_desirability_score":0.0,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":false,"primary_use":"Agriculture/Cultivated Crops","zoning_code":12,"tree_density":0.0,"land_cover_type":"cultivated_crops","tree_size":null,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":0.0,"num_4_inch_diameter_trees":0.0,"num_6_inch_diameter_trees":0.0,"num_8_inch_diameter_trees":0.0,"num_10_inch_diameter_trees":0.0,"num_12_inch_diameter_trees":0.0,"num_14_inch_diameter_trees":0.0,"num_16_inch_diameter_trees":0.0,"num_18_inch_diameter_trees":0.0,"num_20_inch_diameter_trees":0.0,"num_22_inch_diameter_trees":0.0,"num_24_inch_diameter_trees":0.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":127,"x":0,"y":1,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":3.75501,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":true,"primary_use":"Forest","zoning_code":12,"tree_density":0.8,"land_cover_type":"deciduous","tree_size":12.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":1.0,"num_4_inch_diameter_trees":3.0,"num_6_inch_diameter_trees":5.0,"num_8_inch_diameter_trees":5.0,"num_10_inch_diameter_trees":7.0,"num_12_inch_diameter_trees":11.0,"num_14_inch_diameter_trees":12.0,"num_16_inch_diameter_trees":15.0,"num_18_inch_diameter_trees":11.0,"num_20_inch_diameter_trees":10.0,"num_22_inch_diameter_trees":1.0,"num_24_inch_diameter_trees":4.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":128,"x":1,"y":1,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":3.58391,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":true,"primary_use":"Forest","zoning_code":12,"tree_density":0.87,"land_cover_type":"deciduous","tree_size":5.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":95.0,"num_4_inch_diameter_trees":51.0,"num_6_inch_diameter_trees":36.0,"num_8_inch_diameter_trees":21.0,"num_10_inch_diameter_trees":19.0,"num_12_inch_diameter_trees":13.0,"num_14_inch_diameter_trees":7.0,"num_16_inch_diameter_trees":7.0,"num_18_inch_diameter_trees":4.0,"num_20_inch_diameter_trees":2.0,"num_22_inch_diameter_trees":2.0,"num_24_inch_diameter_trees":2.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":129,"x":2,"y":1,"type":"LandTile","base_cover_type":"cultivated_crops","permitted_actions":[],"zone_type":"none","local_desirability_score":0.0,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":false,"primary_use":"Agriculture/Cultivated Crops","zoning_code":2,"tree_density":0.0,"land_cover_type":"cultivated_crops","tree_size":null,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":0.0,"num_4_inch_diameter_trees":0.0,"num_6_inch_diameter_trees":0.0,"num_8_inch_diameter_trees":0.0,"num_10_inch_diameter_trees":0.0,"num_12_inch_diameter_trees":0.0,"num_14_inch_diameter_trees":0.0,"num_16_inch_diameter_trees":0.0,"num_18_inch_diameter_trees":0.0,"num_20_inch_diameter_trees":0.0,"num_22_inch_diameter_trees":0.0,"num_24_inch_diameter_trees":0.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":253,"x":0,"y":2,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":3.72275,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":true,"primary_use":"Forest","zoning_code":12,"tree_density":0.86,"land_cover_type":"deciduous","tree_size":8.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":56.0,"num_4_inch_diameter_trees":35.0,"num_6_inch_diameter_trees":29.0,"num_8_inch_diameter_trees":16.0,"num_10_inch_diameter_trees":16.0,"num_12_inch_diameter_trees":10.0,"num_14_inch_diameter_trees":14.0,"num_16_inch_diameter_trees":4.0,"num_18_inch_diameter_trees":7.0,"num_20_inch_diameter_trees":4.0,"num_22_inch_diameter_trees":8.0,"num_24_inch_diameter_trees":2.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":254,"x":1,"y":2,"type":"LandTile","base_cover_type":"forest","permitted_actions":[],"zone_type":"none","local_desirability_score":1.60167,"total_desirability_score":10.0,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":false,"primary_use":"Forest","zoning_code":12,"tree_density":0.86,"land_cover_type":"deciduous","tree_size":8.0,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":0.0,"num_4_inch_diameter_trees":0.0,"num_6_inch_diameter_trees":1.0,"num_8_inch_diameter_trees":76.0,"num_10_inch_diameter_trees":104.0,"num_12_inch_diameter_trees":1.0,"num_14_inch_diameter_trees":0.0,"num_16_inch_diameter_trees":0.0,"num_18_inch_diameter_trees":0.0,"num_20_inch_diameter_trees":0.0,"num_22_inch_diameter_trees":0.0,"num_24_inch_diameter_trees":0.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0},{"id":255,"x":2,"y":2,"type":"LandTile","base_cover_type":"cultivated_crops","permitted_actions":[],"zone_type":"none","local_desirability_score":0.0,"total_desirability_score":8.50922,"can_be_surveyed":false,"is_surveyed":false,"bought_by_developer":false,"bought_by_timber_company":false,"outpost_requested":false,"survey_requested":false,"is_marten_suitable":false,"primary_use":"Agriculture/Cultivated Crops","zoning_code":2,"tree_density":0.0,"land_cover_type":"cultivated_crops","tree_size":null,"development_intensity":null,"imperviousness":0.0,"num_2_inch_diameter_trees":0.0,"num_4_inch_diameter_trees":0.0,"num_6_inch_diameter_trees":0.0,"num_8_inch_diameter_trees":0.0,"num_10_inch_diameter_trees":0.0,"num_12_inch_diameter_trees":0.0,"num_14_inch_diameter_trees":0.0,"num_16_inch_diameter_trees":0.0,"num_18_inch_diameter_trees":0.0,"num_20_inch_diameter_trees":0.0,"num_22_inch_diameter_trees":0.0,"num_24_inch_diameter_trees":0.0,"housing_capacity":0,"housing_occupants":0,"housing_type":null,"harvest_area":false,"supported_saplings":0,"tree_type":"none","outpost":false,"marten_population":0.0,"vole_population":0.0}],"contracts_included_with_ids":[],"contracts_attached_to_ids":[]}}'


